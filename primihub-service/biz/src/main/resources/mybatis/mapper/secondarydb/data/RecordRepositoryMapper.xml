<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.primihub.biz.repository.secondarydb.data.RecordRepository">

    <sql id="psiRecordColumns">
        id
        ,
               record_id,
               psi_name,
               psi_id,
               psi_task_id,
               task_state,
               origin_organ_id,
               target_organ_id,
               start_time,
               commit_rows_num,
               end_time,
               result_rows_num,
               is_del,
               create_date,
               update_date
    </sql>


    <select id="selectPsiRecordByRecordId" resultType="com.primihub.biz.entity.data.po.PsiRecord">
        select <include refid="psiRecordColumns"></include>
        from psi_record
        where record_id = #{recordId}
    </select>

    <select id="selectPirRecordByRecordId" resultType="com.primihub.biz.entity.data.po.PirRecord">
        select id,
               record_id,
               pir_name,
               pir_task_id,
               task_state,
               origin_organ_id,
               target_organ_id,
               start_time,
               commit_rows_num,
               end_time,
               result_rows_num,
               is_del,
               create_date,
               update_date
        from pir_record
        where record_id = #{recordId}
    </select>

    <select id="selectPsiRecordList" parameterType="com.primihub.biz.entity.data.req.RecordReq" resultType="com.primihub.biz.entity.data.po.PsiRecord">
        select
        <include refid="psiRecordColumns"/>
        from psi_record
        <if test="taskName != null and taskName != ''">
            where psi_name like CONCAT('%',#{taskName,jdbcType=VARCHAR},'%')
        </if>
    </select>

</mapper>